#!/usr/bin/env python
#
# build-dataset
#

import os
import sys
import subprocess as sp
from tempfile import TemporaryDirectory
from xml.etree import ElementTree


def arg_parser():
    from argparse import ArgumentParser
    parser = ArgumentParser()
    return parser


def main(argv=None):
    if argv is None:
        argv = sys.argv[1:]
    args = arg_parser().parse_args(argv)

    try:
        alien_find = sp.check_output('which alien_find', shell=True, encoding='utf-8').strip()
    except sp.CalledProcessError:
        print("Erro: Not in alien environment", file=sys.stderr)
        return 1


    with TemporaryDirectory() as tmpdir:
        os.chdir(tmpdir)

        collection_name = 'foobar'

        data_path = '/alice/sim/2016/LHC16i3a/246217'
        file_pattern = '/AOD/00*/AliAOD.root'

        # tempfile.NamedTemporaryFile('w')
        file_data = sp.check_output([alien_find, '-x', collection_name, data_path, file_pattern], stderr=sp.DEVNULL)
        xml = ElementTree.fromstring(file_data)

        print(ElementTree.tostring(xml).decode())

    # if sp.run("which alien_find", shell=True).returncode != 0:
    #     print("Erro: Not in alien environment", file=sys.stderr)
    #     return 1

    # sp.run('')
    # print("ok")



if __name__ == "__main__":
    exit(main())
